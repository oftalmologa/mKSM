# mKSM

Official source code of the mKSM algorithm proposed in the article "[Automated measurement of the foveal avascular zone in healthy eyes on Heidelberg spectralis optical coherence tomography angiography](https://www.medrxiv.org/content/medrxiv/early/2021/02/08/2020.08.06.20169672.full.pdf)"

## Needed software

* [ImageJ](https://imagej.net/). ImageJ is a  scientific image visualization and processing software. You should install the [Fiji distribution](https://imagej.net/software/fiji/), which is ImageJ with some extra plugins, some of which are needed by mKSM.
* [AngioTool](https://ccrod.cancer.gov/confluence/display/ROB2/Home). AngioTool is an angiography image processing tool. For our study we used AngioTool version 0.6a (02.18.14).

## Usage instructions

1. Copy a Heidelberg Spectralis Optical Coherence Tomography Angiography (HS-OCTA) image to your computer.
2. Execute AngioTool.
3. Open the angio OCT image and press "Run Analysis".
4. Save the image.
5. Run Fiji.
6. Open the image generated by AngioTool
7. In the _Plugins_ menu, select _Macros_ > _Edit_ and select the mKSM.ijm file downloaded from this github project.
8. Select "Run"
9. A new file will be saved in the same folder with the analyzed image, and a text file will also be saved with the measurements.

You can also run this macro in batch over all the images in a folder.

## FAQ

### What does mKSM stand for?

mKSM stands for "modified KSM". mKSM is an evolution of the original KSM approach.

### What is the KSM algorithm?

KannoSaitama Macro (KSM) is an approach proposed by [Ishi et al. (27)](https://pubmed.ncbi.nlm.nih.gov/31171995/) to measure the FAZ area using ImageJ software. 

### What are the differences between the KSM and mKSM algorithms?

The KSM method is specific to the SS-OCTA equipment (Plex Elite 9000, Version 1.6.0.21130; Carl Zeiss Meditec Dublin, CA).

mKSM improves over KSM on the tolerance to visual artefacts and uncentered images and extends its applicability to the Heidelberg Spectralis Optical Coherence Tomography Angiography (HS-OCTA) equipment.

### What programming language is the mKSM coded in?

Our implementation of the mKSM algorithm is coded in the [ImageJ macro language](https://imagej.nih.gov/ij/developer/macro/macros.html).

### How does mKSM work?

From the [article](https://www.medrxiv.org/content/medrxiv/early/2021/02/08/2020.08.06.20169672.full.pdf):

> [...] mKSM first takes an OCTA image and applies the processing from AngioTool, obtaining a cleaner version of the vascular network image. Then, mKSM estimates the center of the foveal area by computing the center of mass of the image pixels, taking the pixel brightness value as its mass. Detecting the center of the foveal area instead of assuming that it is located at the center of the image, grants mKSM tolerance to uncentered OCTA images. Once the center of the foveal area has been estimated, mKSM applies a random 2D shift to it and computes the foveal area by means of the KSM approach. This measure is repeated 20 times, with different values for the random 2D shift of the foveal area center. The final area is computed by taking the median value of all the previous measures (to deterministically obtaining the same result for an input OCTA image, we use a fixed sequence of random numbers) [...]

### Can I use the mKSM algorithm in my work or study?

Yes! Please cite the following article:

---
**Automated measurement of the foveal avascular zone in healthy eyes on Heidelberg Spectralis Optical Coherence Tomography Angiography**
  
Laura Gutierrez-Benitez, Yolanda Palomino, Noe Casas, Mouafk Asaad
  
Archivos de la Sociedad Española de Oftalmología (English Edition), 2022, volume 97, number 8, pages 432-442 (Elsevier Doyma)
  
doi: 10.1016/j.oftale.2022.05.001



